name: Build Debos and run tests
on: [pull_request, push]

jobs:
  build-test:
    name: Build Debos and run tests
    runs-on: ubuntu-latest
    container:
      image: 'docker/Dockerfile'
      options: >-
        --security-opt label=disable
        --cap-add=SYS_PTRACE
        --tmpfs /scratch:exec
    env:
      TMP: '/scratch'
    steps:
      - name: Repository checkout
        uses: actions/checkout@v2

      - name: Run unit tests
        run: go test -v ./...

      - name: Run test recipes
        run: cd tests && ./tests.sh
